

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Autograd mechanics &mdash; PyTorch 0.1.6 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/pytorch_theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PyTorch 0.1.6 documentation" href="../index.html"/>
        <link rel="next" title="CUDA semantics" href="cuda.html"/>
        <link rel="prev" title="PyTorch documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/pytorch-logo-dark.svg" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Autograd mechanics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#excluding-subgraphs-from-backward">Excluding subgraphs from backward</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requires-grad"><code class="docutils literal"><span class="pre">requires_grad</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#volatile"><code class="docutils literal"><span class="pre">volatile</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-autograd-encodes-the-history">How autograd encodes the history</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-place-operations-on-variables">In-place operations on Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-place-correctness-checks">In-place correctness checks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">CUDA semantics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cuda.html#best-practices">Best practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cuda.html#use-pinned-memory-buffers">Use pinned memory buffers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending PyTorch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extending-torch-autograd">Extending <code class="docutils literal"><span class="pre">torch.autograd</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extending-torch-nn">Extending <code class="docutils literal"><span class="pre">torch.nn</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="extending.html#adding-a-module">Adding a <code class="docutils literal"><span class="pre">Module</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#writing-custom-c-extensions">Writing custom C extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multiprocessing.html">Multiprocessing best practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="multiprocessing.html#sharing-cuda-tensors">Sharing CUDA tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiprocessing.html#best-practices-and-tips">Best practices and tips</a><ul>
<li class="toctree-l3"><a class="reference internal" href="multiprocessing.html#avoiding-and-fighting-deadlocks">Avoiding and fighting deadlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="multiprocessing.html#reuse-buffers-passed-through-a-queue">Reuse buffers passed through a Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="multiprocessing.html#asynchronous-multiprocess-training-e-g-hogwild">Asynchronous multiprocess training (e.g. Hogwild)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multiprocessing.html#hogwild">Hogwild</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../torch.html">torch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../torch.html#tensors">Tensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#creation-ops">Creation Ops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#indexing-slicing-joining-mutating-ops">Indexing, Slicing, Joining, Mutating Ops</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torch.html#random-sampling">Random sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torch.html#serialization">Serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torch.html#parallelism">Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torch.html#math-operations">Math operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#pointwise-ops">Pointwise Ops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#reduction-ops">Reduction Ops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#comparison-ops">Comparison Ops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#other-operations">Other Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torch.html#blas-and-lapack-operations">BLAS and LAPACK Operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nn.html">torch.nn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#containers">Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#convolution-layers">Convolution Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#pooling-layers">Pooling Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#non-linear-activations">Non-linear Activations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#normalization-layers">Normalization layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#recurrent-layers">Recurrent layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#linear-layers">Linear layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#dropout-layers">Dropout layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#sparse-layers">Sparse layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#loss-functions">Loss functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#vision-layers">Vision layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nn.html#multi-gpu-layers">Multi-GPU layers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../optim.html">torch.optim</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../optim.html#how-to-use-an-optimizer">How to use an optimizer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../optim.html#constructing-it">Constructing it</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optim.html#per-parameter-options">Per-parameter options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../optim.html#taking-an-optimization-step">Taking an optimization step</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../optim.html#optimizer-step"><code class="docutils literal"><span class="pre">optimizer.step()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../optim.html#optimizer-step-closure"><code class="docutils literal"><span class="pre">optimizer.step(closure)</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../optim.html#algorithms">Algorithms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autograd.html">torch.autograd</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../autograd.html#variable">Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../autograd.html#api-compatibility">API compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autograd.html#in-place-operations-on-variables">In-place operations on Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autograd.html#in-place-correctness-checks">In-place correctness checks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../autograd.html#function"><span class="hidden-section">Function</span></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../multiprocessing.html">torch.multiprocessing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../multiprocessing.html#strategy-management">Strategy management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiprocessing.html#sharing-cuda-tensors">Sharing CUDA tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiprocessing.html#sharing-strategies">Sharing strategies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../multiprocessing.html#file-descriptor-file-descriptor">File descriptor - <code class="docutils literal"><span class="pre">file_descriptor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../multiprocessing.html#file-system-file-system">File system - <code class="docutils literal"><span class="pre">file_system</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../legacy.html">torch.legacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda.html">torch.cuda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cuda.html#communication-collectives">Communication collectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cuda.html#streams-and-events">Streams and events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ffi.html">torch.utils.ffi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_zoo.html">torch.utils.model_zoo</a></li>
</ul>
<p class="caption"><span class="caption-text">torchvision Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../torchvision/torchvision.html">torchvision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torchvision/datasets.html">torchvision.datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/datasets.html#coco">COCO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/datasets.html#captions">Captions:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/datasets.html#detection">Detection:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/datasets.html#lsun">LSUN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/datasets.html#cifar">CIFAR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../torchvision/models.html">torchvision.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../torchvision/transforms.html">torchvision.transforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#transforms-compose"><code class="docutils literal"><span class="pre">transforms.Compose</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/transforms.html#transforms-on-pil-image">Transforms on PIL.Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#scale-size-interpolation-image-bilinear"><code class="docutils literal"><span class="pre">Scale(size,</span> <span class="pre">interpolation=Image.BILINEAR)</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#centercrop-size-center-crops-the-image-to-the-given-size"><code class="docutils literal"><span class="pre">CenterCrop(size)</span></code> - center-crops the image to the given size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#randomcrop-size-padding-0"><code class="docutils literal"><span class="pre">RandomCrop(size,</span> <span class="pre">padding=0)</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#randomhorizontalflip"><code class="docutils literal"><span class="pre">RandomHorizontalFlip()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#randomsizedcrop-size-interpolation-image-bilinear"><code class="docutils literal"><span class="pre">RandomSizedCrop(size,</span> <span class="pre">interpolation=Image.BILINEAR)</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#pad-padding-fill-0"><code class="docutils literal"><span class="pre">Pad(padding,</span> <span class="pre">fill=0)</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/transforms.html#transforms-on-torch-tensor">Transforms on torch.*Tensor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#normalize-mean-std"><code class="docutils literal"><span class="pre">Normalize(mean,</span> <span class="pre">std)</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/transforms.html#conversion-transforms">Conversion Transforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../torchvision/transforms.html#generic-transofrms">Generic Transofrms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/transforms.html#lambda-lambda"><code class="docutils literal"><span class="pre">Lambda(lambda)</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../torchvision/utils.html">torchvision.utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/utils.html#make-grid-tensor-nrow-8-padding-2">make_grid(tensor, nrow=8, padding=2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../torchvision/utils.html#save-image-tensor-filename-nrow-8-padding-2">save_image(tensor, filename, nrow=8, padding=2)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PyTorch</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Autograd mechanics</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notes/autograd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="autograd-mechanics">
<h1>Autograd mechanics<a class="headerlink" href="#autograd-mechanics" title="Permalink to this headline">¶</a></h1>
<p>This note will present an overview of how autograd works and records the
operations. It&#8217;s not strictly necessary to understand all this, but we recommend
getting familiar with it, as it will help you write more efficient, cleaner
programs, and can aid you in debugging.</p>
<div class="section" id="excluding-subgraphs-from-backward">
<span id="excluding-subgraphs"></span><h2>Excluding subgraphs from backward<a class="headerlink" href="#excluding-subgraphs-from-backward" title="Permalink to this headline">¶</a></h2>
<p>Every Variable has two flags: <code class="xref py py-attr docutils literal"><span class="pre">requires_grad</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">volatile</span></code>.
They both allow for fine grained exclusion of subgraphs from gradient
computation and can increase efficiency.</p>
<div class="section" id="requires-grad">
<span id="excluding-requires-grad"></span><h3><code class="docutils literal"><span class="pre">requires_grad</span></code><a class="headerlink" href="#requires-grad" title="Permalink to this headline">¶</a></h3>
<p>If there&#8217;s a single input to an operation that requires gradient, its output
will also require gradient. Conversely, only if all inputs don&#8217;t require
gradient, the output also won&#8217;t require it. Backward computation is never
performed in the subgraphs, where all Variables didn&#8217;t require gradients.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">requires_grad</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">requires_grad</span>
<span class="go">True</span>
</pre></div>
</div>
<p>This is especially useful when you want to freeze part of your model, or you
know in advance that you&#8217;re not going to use gradients w.r.t. some parameters.
For example if you want to finetune a pretrained CNN, it&#8217;s enough to switch the
<code class="xref py py-attr docutils literal"><span class="pre">requires_grad</span></code> flags in the frozen base, and no intermediate buffers will
be saved, until the computation gets to the last layer, where the affine
transform will use weights that require gradient, and the output of the network
will also require them.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
    <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># Replace the last fully-connected layer</span>
<span class="c1"># Parameters of newly constructed modules have requires_grad=True by default</span>
<span class="n">model</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Optimize only the classifier</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="volatile">
<h3><code class="docutils literal"><span class="pre">volatile</span></code><a class="headerlink" href="#volatile" title="Permalink to this headline">¶</a></h3>
<p>Volatile is recommended for purely inference mode, when you&#8217;re sure you won&#8217;t
be even calling <cite>.backward()</cite>. It&#8217;s more efficient than any other autograd
setting - it will use the absolute minimal amount of memory to evaluate the
model. <code class="docutils literal"><span class="pre">volatile</span></code> also determines that <code class="docutils literal"><span class="pre">requires_grad</span> <span class="pre">is</span> <span class="pre">False</span></code>.</p>
<p>Volatile differs from <a class="reference internal" href="#excluding-requires-grad"><span class="std std-ref">requires_grad</span></a> in how the flag propagates.
If there&#8217;s even a single volatile input to an operation, its output is also
going to be volatile. Volatility spreads accross the graph much easier than
non-requiring gradient - you only need a <strong>single</strong> volatile leaf to have a
volatile output, while you need <strong>all</strong> leaves to not require gradient to
have an output the doesn&#8217;t require gradient. Using volatile flag you don&#8217;t
need to change any settings of your model parameters to use it for
inference. It&#8217;s enough to create a volatile input, and this will ensure that
no intermediate states are saved.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">regular_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">volatile_input</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">volatile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="n">regular_input</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="n">volatile_input</span><span class="p">)</span><span class="o">.</span><span class="n">requires_grad</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="n">volatile_input</span><span class="p">)</span><span class="o">.</span><span class="n">volatile</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">(</span><span class="n">volatile_input</span><span class="p">)</span><span class="o">.</span><span class="n">creator</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-autograd-encodes-the-history">
<h2>How autograd encodes the history<a class="headerlink" href="#how-autograd-encodes-the-history" title="Permalink to this headline">¶</a></h2>
<p>Each Variable has a <code class="docutils literal"><span class="pre">.creator</span></code> attribute, that points to the function, of
which it is an output. This is an entry point to a directed acyclic graph (DAG)
consisting of <code class="xref py py-class docutils literal"><span class="pre">Function</span></code> objects as nodes, and references between them
being the edges. Every time an operation is performed, a new <code class="xref py py-class docutils literal"><span class="pre">Function</span></code>
representing it is instantiated, its <a class="reference internal" href="../autograd.html#torch.autograd.Function.forward" title="torch.autograd.Function.forward"><code class="xref py py-meth docutils literal"><span class="pre">forward()</span></code></a>
method is called, and its output <code class="xref py py-class docutils literal"><span class="pre">Variable</span></code> s creators are set to it.
Then, by following the path from any <code class="xref py py-class docutils literal"><span class="pre">Variable</span></code> to the leaves, it is
possible to reconstruct the sequence of operations that has created the data,
and automatically compute the gradients.</p>
<p>An important thing to note is that the graph is recreated from scratch at every
iteration, and this is exactly what allows for using arbitrary Python control
flow statements, that can change the overall shape and size of the graph at
every iteration. You don&#8217;t have to encode all possible paths before you
launch the training - what you run is what you differentiate.</p>
</div>
<div class="section" id="in-place-operations-on-variables">
<h2>In-place operations on Variables<a class="headerlink" href="#in-place-operations-on-variables" title="Permalink to this headline">¶</a></h2>
<p>Supporting in-place operations in autograd is a hard matter, and we discourage
their use in most cases. Autograd&#8217;s aggressive buffer freeing and reuse makes
it very efficient and there are very few occasions when in-place operations
actually lower memory usage by any significant amount. Unless you&#8217;re operating
under heavy memory pressure, you might never need to use them.</p>
<p>There are two main reasons that limit the applicability of in-place operations:</p>
<ol class="arabic simple">
<li>Overwriting values required to compute gradients. This is why variables don&#8217;t
support <code class="docutils literal"><span class="pre">log_</span></code>. Its gradient formula requires the original input, and while
it is possible to recreate it by computing the inverse operation, it is
numerically unstable, and requires additional work that often defeats the
purpose of using these functions.</li>
<li>Every in-place operation actually requires the implementation to rewrite the
computational graph. Out-of-place versions simply allocate new objects and
keep references to the old graph, while in-place operations, require
changing the creator of all inputs to the <code class="xref py py-class docutils literal"><span class="pre">Function</span></code> representing
this operation. This can be tricky, especially if there are many Variables
that reference the same storage (e.g. created by indexing or transposing),
and in-place functions will actually raise an error if the storage of
modified inputs is referenced by any other <code class="xref py py-class docutils literal"><span class="pre">Variable</span></code>.</li>
</ol>
</div>
<div class="section" id="in-place-correctness-checks">
<h2>In-place correctness checks<a class="headerlink" href="#in-place-correctness-checks" title="Permalink to this headline">¶</a></h2>
<p>Every variable keeps a version counter, that is incremented every time it&#8217;s
marked dirty in any operation. When a Function saves any tensors for backward,
a version counter of their containing Variable is saved as well. Once you access
<code class="docutils literal"><span class="pre">self.saved_tensors</span></code> it is checked, and if it&#8217;s greater than the saved value
an error is raised.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cuda.html" class="btn btn-neutral float-right" title="CUDA semantics" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral" title="PyTorch documentation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Torch Contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>